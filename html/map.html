<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>&#x25B4 &#x25BE Map</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="htmx.min.js"></script>
</head>

<header>
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="about">About</a></li>
            <li><a href="register-form">Register agent</a></li>
            <li><a href="map">Map</a></li>
        </ul>
    </nav>
</header>

<body>
    <h1>{{.System}} Map</h1>
    <table>
        <tr>
            <th class="legend">Planet</th>
            <th class="legend">Moon</th>
            <th class="legend">Engineered Asteroid</th>
            <th class="legend">Asteroid</th>
            <th class="legend">Fuel Station</th>
            <th class="legend">Jump Gate</th>
            <th class="legend">Asteroid Base</th>
            <th class="legend">Gas Giant</th>
        </tr>
        <tr class="map-height">
            <td class="planet-cell"></td>
            <td class="moon-cell"></td>
            <td class="eng-asteroid-cell"></td>
            <td class="asteroid-cell"></td>
            <td class="fuel-cell"></td>
            <td class="gate-cell"></td>
            <td class="asteroid-base-cell"></td>
            <td class="gas-giant-cell"></td>
        </tr>
    </table>
    <table>
        <caption>Map of the {{.System}} solar system</caption>
        {{- $divisor := .Divisor -}}
        {{- $minX := .MinX -}}
        {{- $curX := .MinX -}}
        {{- $curY := .MaxY -}}
        {{- $waypoints := .Waypoints -}}
        {{- $xRange := .XRange -}}
        {{- $foundMatch := false -}}
        {{- $colspan := 0 -}}
        {{- range .YRange -}}
        <tr class="map-height">
            {{- $curX = $minX -}}
            {{- range $xRange -}}
                {{- $foundMatch = false -}}
                {{- range $waypoints -}}
                    {{- if (and (eq (div .X $divisor) $curX) (eq (div .Y $divisor) $curY)) -}}
                        <!--<td class="map-width" colspan="{{$colspan -}}"></td>
                            - $colspan = 0 - -->
                        {{- if (eq .Type "ASTEROID") -}}
                        <td class="map-width asteroid-cell" hx-put="/map-hello" hx-swap="outerHTML" hx-trigger="click" hx-vals='{"type":"asteroid-cell"}'></td>
                        {{- else if (eq .Type "MOON") -}}
                            <td class="map-width moon-cell"></td>
                        {{- else if (eq .Type "PLANET") -}}
                            <td class="map-width planet-cell"></td>
                            {{- print .X .Y -}}
                            {{- println .Type -}}
                        {{- else if (eq .Type "FUEL_STATION") -}}
                            <td class="map-width fuel-cell"></td>
                        {{- else if (eq .Type "JUMP_GATE") -}}
                            <td class="map-width gate-cell"></td>
                        {{- else if (eq .Type "ASTEROID_BASE") -}}
                            <td class="map-width asteroid-base-cell"></td>
                        {{- else if (eq .Type "ENGINEERED_ASTEROID") -}}
                            <td class="map-width eng-asteroid-cell"></td>
                        {{- else if (eq .Type "GAS_GIANT") -}}
                            <td class="map-width gas-giant-cell"></td>
                        {{- else -}}
                            {{- print .X .Y -}}
                            {{- println .Type -}}
                        {{- end -}}
                        <!--TODO: moons often have exact same (x,y) coord-->
                        {{- $foundMatch = true -}}
                        {{- break -}}
                    {{- end -}}
                {{- end -}}
                {{- if (eq $foundMatch false) -}}
                <!-- - $colspan = increment $colspan - -->
                    <td class="map-width"></td>
                {{- end -}}
                {{- $curX = increment $curX -}}
            {{- end -}}
            <td class="map-width" colspan="{{$colspan}}"></td>
            </tr>
            {{- $curY = decrement $curY -}}
        {{- end -}}
    </table>
</body>
</html>
