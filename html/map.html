<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>&#x25B4 &#x25BE Map</title>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="htmx.min.js"></script>
</head>

<header>
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="about">About</a></li>
            <li><a href="register-form">Register agent</a></li>
            <li><a href="map">Map</a></li>
        </ul>
    </nav>
</header>

<body>
    <h2>{{.System}} Map</h2>
    <table>
        <tr>
            <th>Planet</th>
            <th>Moon</th>
            <th>Engineered Asteroid</th>
        </tr>
        <tr class="map-height">
            <td class="map-width planet-cell"></td>
            <td class="map-width moon-cell"></td>
            <td class="map-width eng-asteroid-cell"></td>
        </tr>
    </table>
    <table>
        <tr class="map-height">
            <td class="bordered map-width" hx-put="/map-hello" hx-swap="outerHTML" hx-trigger="click"></td>
            <td class="bordered map-width"></td>
        </tr>
        <tr class="map-height">
            <td class="bordered map-width"></td>
            <td class="bordered map-width"></td>
        </tr>
    </table>
    <table>
        {{$divisor := .Divisor}}
        {{$minX := .MinX}}
        {{$curX := .MinX}}
        {{$curY := .MaxY}}
        {{$waypoints := .Waypoints}}
        {{$xRange := .XRange}}
        {{$foundMatch := false}}
        {{range .YRange}}
            <tr class="map-height">
            {{$curX = $minX}}
            {{range $xRange}}
                {{$foundMatch = false}}
                {{range $waypoints}}
                    {{if (and (eq (div .X $divisor) $curX) (eq (div .Y $divisor) $curY))}}
                        {{if (eq .Type "MOON")}}
                            <td class="map-width moon-cell"></td>
                        {{else if (eq .Type "PLANET")}}
                            <td class="map-width planet-cell"></td>
                        {{else if (eq .Type "ASTEROID")}}
                            <td class="map-width asteroid-cell"></td>
                        {{else if (eq .Type "FUEL_STATION")}}
                            <td class="map-width fuel-cell"></td>
                        {{else if (eq .Type "JUMP_GATE")}}
                            <td class="map-width gate-cell"></td>
                        {{else if (eq .Type "ASTEROID_BASE")}}
                            <td class="map-width asteroid-base-cell"></td>
                        {{else if (eq .Type "ENGINEERED_ASTEROID")}}
                            <td class="map-width eng-asteroid-cell"></td>
                        {{else if (eq .Type "GAS_GIANT")}}
                            <td class="map-width gas-giant-cell"></td>
                        {{else}}
                            {{print .X .Y}}
                            {{println .Type}}
                        {{end}}
                        <!--TODO: moons often have exact same (x,y) coord-->
                        {{$foundMatch = true}}
                        {{break}}
                    {{end}}
                {{end}}
                {{if (eq $foundMatch false)}}
                    <td class="map-width"></td>
                {{end}}
                {{$curX = increment $curX}}
            {{end}}
            </tr>
            {{$curY = decrement $curY}}
        {{end}}
    </table>
</body>
</html>
